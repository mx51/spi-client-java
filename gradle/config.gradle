task cleanConfig(type: Delete, description: 'Deletes dynamic configuration file.') {
    delete "$projectDir/src/gen"
}

task generateConfig(description: 'Generates dynamic configuration file.') {
    outputs.upToDateWhen { false }

    doLast {
        def pkg = project.configPackage
        def fields = project.configFields

        def srcPath = "$projectDir/src/gen/java/${pkg.tokenize('.').join('/')}"
        def srcDir = new File(srcPath)
        srcDir.mkdirs()

        new File(srcDir, "Config.java").text = [
                "// DO NOT EDIT!",
                "// This file is generated by 'generateConfig' Gradle task.",
                "",
                "package $pkg;",
                "",
                "final class Config {",
                *fields.collect { k, v ->
                    "    static final String $k = \"$v\";"
                },
                "",
                "    private Config() {}",
                "}",
                "",
        ].join("\n")
    }
}

clean.dependsOn 'cleanConfig'
compileJava.dependsOn 'generateConfig'
